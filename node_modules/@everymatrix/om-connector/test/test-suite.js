const { onProcessExit } = require('@everymatrix/om-connector/lib/utils');
const { PullConsistencyChecker, PushConsistencyChecker } = require('./tests/consistency-check');

const FEED_ADDRESS = '';
const FEED_PUSH_PORT = '';
const FEED_PULL_PORT = '';
const SUBSCRIPTION_NAME = '';

if (!FEED_ADDRESS || !FEED_PULL_PORT || !FEED_PUSH_PORT || !SUBSCRIPTION_NAME) {
    throw new Error('Please provide the connection details.');
}

const pushConsistencyChecker = new PushConsistencyChecker(FEED_ADDRESS, FEED_PUSH_PORT);
pushConsistencyChecker.start(SUBSCRIPTION_NAME);

const pullConsistencyChecker = new PullConsistencyChecker(`http://${FEED_ADDRESS}`, FEED_PULL_PORT);
pullConsistencyChecker.start(SUBSCRIPTION_NAME);

onProcessExit(async () => {
    try {
        if (pullConsistencyChecker) {
            await pullConsistencyChecker.stop();
        }
        if (pushConsistencyChecker) {
            await pushConsistencyChecker.stop();
        }
    } catch (e) {
        console.error(e);
    }
});
